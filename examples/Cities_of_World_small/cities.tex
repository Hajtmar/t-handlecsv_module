% Volání: context --arguments="CountryAbbrev=USA, Country=United States" cities
\usemodule[handlecsv]

\setuppagenumbering[state=stop]
\setupbodyfont[regular, 8pt]

%http://wiki.contextgarden.net/TABLE
\setupTABLE[split=yes,location={middle,lohi}, height=4.5mm]
\setupTABLE[row][first][background=color,backgroundcolor=gray,foregroundcolor=black,height=8mm, align={middle,lohi}]
\setupTABLE[row][last][background=color,backgroundcolor=gray,foregroundcolor=black,height=8mm,align={middle,lohi}]
\setupTABLE[c][1][background=color,backgroundcolor=gray,align=middle, width=7mm]
\setupTABLE[c][2][align={right, lohi}, width=4cm]
\setupTABLE[c][3][align={middle, lohi}, width=2.5cm]
\setupTABLE[c][4][align={right, lohi}, width=7cm]

\unexpanded\def\tableaction{%
\expanded{\bTR\bTD\SerNum\eTD\bTD\Name\eTD\bTD\Population\eTD\bTD\Altitude\eTD\eTR}%
}
	
\starttext
\midaligned{\ssb List of biggest cities of \env{Country} (\env{CountryAbbrev})}

\blank[big]

\setheader 
\opencsvfile{cities.csv}

\bTABLE
\bTR\bTD\ssx SerNum \eTD\bTD\ssx Name\eTD\bTD\ssx Population\eTD\bTD\ssx Altitude\eTD\eTR
\doloopif{\CountryAbbrev}{==}{\env{CountryAbbrev}}{\tableaction}
\bTR\bTD-- \eTD\bTD\ssx -- \eTD\bTD -- \eTD\bTD -- \eTD\eTR
\eTABLE

\page[no]	

\stoptext
