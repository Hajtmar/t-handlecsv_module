\input ../incl_handlecsv_file.tex




\starttext

Tohle byla trochu slepá větev...

\opencsvfile{numbers.csv}

\unsetheader
\opencsvfile{letters.csv}




\getcsvcellof[letters.csv][1,5]


\getcsvcellof[letters.csv]['A',5]


\csvfilename


\getcsvcellof[numbers.csv][1,9]

\csvfilename

\hairline

\setsep{,}
\setheader
\opencsvfile{lide.csv}

\csvfilename
%\numrows



\setsep{;}
\setheader
\opencsvfile{countries.csv}

\csvfilename
\numrows

\numrows[letters.csv]

\csvfilename -- \numrows


\opencsvfile{countries.csv}

\csvfilename -- \numrows


\opencsvfile{countries.csv}

\csvfilename -- \numrows


\csvfilename -- \numrows -- \numrows[] --


\opencsvfile{letters.csv}

\csvfilename -- \numrows -- \numrows[]



1 \\numrows = \\numrowsof[] \numrows -- \numrowsof[]

2 Numrows of [lide.csv] \numrowsof[lide.csv]

3 \numrowsof[countries.csv]

4 \numrows[letters.csv]

%\dorecurse{\number\numrows\relax}{\recurselevel \crlf}

%\dorecurse{\number\numrows\relax}{\recurselevel \crlf}

%\dorecurse{\numexpr{\numrows}}{\recurselevel \crlf}

%\dorecurse{\number\numrows\relax}{\recurselevel \crlf}


%\dorecurse{\numrows[lide.csv]}{\recurselevel \crlf}


1: \getcsvcellof[lide.csv][1,9]

A: \getcsvcellof[lide.csv]["A",9]

cA: \getcsvcellof[lide.csv]["cA",9]

Lastname: \getcsvcellof[lide.csv]["Lastname",9]

Last name: \getcsvcellof[lide.csv]["Last name",9]

Lastxname: \getcsvcellof[lide.csv]["Lastxname",9]

Firstname: \getcsvcellof[lide.csv]["Firstname",9]

Firstxname: \getcsvcellof[lide.csv]["Firstxname",9]


\numrows lide: \numrows{lide.csv}

\opencsvfile{letters.csv}

current opened filename: \csvfilename

current opened filename numrows: \numrows

Dobrá vychytávka:

\dorecurse{\numrowsof[lide.csv]}{\recurselevel -- \getcsvcellof[lide.csv]['Firstname',\recurselevel]\crlf}


Otevírám CSV soubor letters.csv\par

\opencsvfile{letters.csv}\par

Počet řádků načtených ze souboru: \numrows\par





LETTERS.CSV

\opencsvfile{letters.csv}

\ctxlua{tex.sprint("Current file: ["..thirddata.handlecsv.getcurrentcsvfilename().."]")}

TEST:

\ctxlua{
  local f = thirddata.handlecsv.getcurrentcsvfilename() or "nil"
  local n = thirddata.handlecsv.gNumRows[f] or "nil"
  tex.sprint("File: ["..f.."], rows: ["..n.."]")
}



NUMROWS: \numrows


tex.sprint

\ctxlua{tex.sprint("["..thirddata.handlecsv.numrows().."]")}



%\dorecurse{\numrows}{\recurselevel \crlf}


T E S T

Otevírám CSV soubor letters.csv\par

\opencsvfile{letters.csv}\par

\ctxlua{
  local f = thirddata.handlecsv.getcurrentcsvfilename() or "none"
  local n = thirddata.handlecsv.gNumRows[f] or "nil"
  tex.sprint("Aktuální soubor: ["..f.."], počet řádků: ["..n.."]")
}
\par




%\dorecurse{\numrows{lide.csv}}{\getcsvcellof[lide.csv]["Lastname",\recurselevel]}


%\dorecurse{\numrows{numbers.csv}}{\getcsvcellof[numbers.csv]["B",\recurselevel]}
%
%xxx
%
%\dorecurse{\numrows{lide.csv}}{\recurselevel. \getcsvcellof[numbers.csv][1,\recurselevel] -- \getcsvcellof[numbers.csv]['B',\recurselevel] -- \getcsvcellof[numbers.csv]['C',\recurselevel] -- \getcsvcellof[numbers.csv][7,\recurselevel]\crlf }
%
%xxx
%
%
%\dorecurse{\numrows{letters.csv}}{\getcsvcellof[letters.csv]["B",\recurselevel]}
%
%\dorecurse{\numrows{letters.csv}}{\getcsvcellof[letters.csv][2,\recurselevel]}
%
%
%
%
%numrows lide.csv: \numrows{lide.csv}
%
%\csvfilename
%
%numcols lide.csv: \numcols{lide.csv}
%
%numrows numbers.csv: \numrows{numbers.csv}
%
%numrows: \numrows{letters.csv}
%
%\csvfilename
%
%numcols numbers.csv: \numcols{numbers.csv}
%
%numrows letters.csv: \numrows{letters.csv}
%
%numrows countries.csv: \numrows{countries.csv}
%
%numcols letters.csv: \numcols{letters.csv}
%
%numcols: \numcols
%
%countries: \numrows{countries.csv}
%
%\dorecurse{4}{
%
%\recurselevel: \dorecurse{\recurselevel}{\recurselevel x}
%
%}

\stoptext




\def\docommand[#1][#2]%
  {\if!#1!\else#1\fi
  \if!#2!\else#2\fi}

\def\command%
  {\dodoubleargument\docommand}


\def\Docommand[#1]%
  {\if!#1!AAA\else#1\fi}

\def\Command%
  {\dosingleargument\Docommand}



\starttext

1. \command[222][333]

2. \command[222]

3. \command


1. \Command[aaa]

2. \Command



\def\ctnum#1{\ctxlua{if type(tonumber('#1'))=='number' then context('#1') else context(-1) end}}%

\def\Ctnum#1{\ctxlua{if type(tonumber('#1'))=='number' then context('#1') else context(thirddata.handlecsvcells.numrows('#1')) end}}%


\ctnum{5}

\ctnum{aaa}



\optdef\Dumrows[\ctxlua{context(thirddata.handlecsvcells.numrows(''))}]{
	\ifnum\ctnum{\opt}>0 \opt%
	\else\ctxlua{context(thirddata.handlecsvcells.numrows('\opt'))}%
	\fi%
}%

\optdef\Wumrows[\ctxlua{context(thirddata.handlecsvcells.numrows(''))}]{
	\ctnum{\opt}
}%

\optdef\Numrows[\ctxlua{context(thirddata.handlecsvcells.numrows(''))}]{\ctxlua{if type(tonumber('\opt'))=='number' then context('\opt') else context(thirddata.handlecsvcells.numrows('\opt')) end}}%

