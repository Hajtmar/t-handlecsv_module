\usemodule[scancsv]

\opencsvfile{4CM_programme.csv}


\setupcolors[state=start]
\setupurl[color=blue]
\setupinteraction[state=start,color=blue,contrastcolor=blue, style=normal]


\def\href#1#2{\useURL[#2][{#2}][][{#1}]\goto{\url[#2]}[url(#1)]}
%\def\ahref#1{\color[linkcolor]{\ttx \href{#1}{<#1>}}}
\def\ahref#1{\color[linkcolor]{\ttx \href{#1}{#1}}}
\def\fullahref#1{\color[linkcolor]{\ttx \href{#1}{http://#1}}}
\def\mailto#1{\useURL[#1][mailto:#1][][#1]\from[{#1}]}
\def\MailTo#1#2{\useURL[#1][mailto:#1][][#2]\from[{#1}]}
\def\scancsvlua{\href{http://jaroslav.hajtmar.com/storage/tex/scancsv.lua/demo-scancsv.lua.zip}{t-scancsv.mkiv}}
\def\ctm{\href{http://meeting.contextgarden.net/2010/programme.shtml}{4CM}}
\def\te{\href{http://pavel.striz.cz/texperience/}{3TE}}

 

\setuppagenumbering[state=stop]
\setuplayout[backspace=1cm, width=middle,height=29cm, topspace=5mm, header=0cm, footer=5mm]
\setupbodyfont[regular, 9pt]



\setupTABLE[split=yes]
%\setupTABLE[row][first][background=color,backgroundcolor=gray,foregroundcolor=black,height=5mm, align={middle,lohi}]
%\setupTABLE[row][last][background=color,backgroundcolor=gray,foregroundcolor=black,height=8mm,align={middle,lohi}]
\setupTABLE[c][1][background=color,backgroundcolor=gray,align=middle, width=1cm]
\setupTABLE[c][2][align=right, width=6.5cm]
\setupTABLE[c][3][align=right, width=6.5cm]
\setupTABLE[c][4][align=middle, width=2cm]
\setupTABLE[c][5][align=middle, width=1cm]
\setupTABLE[c][6][align=middle, width=1.8cm]


\def\mejl{\mailto{\Email}}
%\def\mejl{\MailTo{\Email}{e-mail}}

\edef\Dinner{Dinner}
\edef\Coffee{Coffee}
\edef\Breakfast{Breakfast}
\edef\Lunch{Lunch}
\edef\Tea{Tea}
\edef\LateTea{Late tea}

%\ifnum
\def\stylbunky{[background=color, backgroundcolor=gray]}
\def\tbc{\blue\bf}


\def\teststylu{\ifx\Author\Dinner\stylbunky\else\ifx\Author\Coffee\stylbunky\else\ifx\Author\Breakfast\stylbunky%
\else\ifx\Author\Lunch\stylbunky\else\ifx\Author\Tea\stylbunky\else\ifx\Author\LateTea\stylbunky%\else ...%
\fi\fi\fi\fi\fi\fi}

\def\teststyluI{\ifx\Author\Dinner\tbc\else\ifx\Author\Coffee\tbc\else\ifx\Author\Breakfast\tbc
\else\ifx\Author\Lunch\tbc\else\ifx\Author\Tea\tbc\else\ifx\Author\LateTea\tbc%\else ....
\fi\fi\fi\fi\fi\fi}



% Header of CSV file: Day;Date;TimeFrom;Author;Programm;Type;Space;Notice
\unexpanded\def\tableaction{%
\catcode`\_=12
\expanded{
\bTR\teststylu\bTD\ssx\TimeFrom\eTD\bTD\teststyluI\ssx\Author\eTD\bTD\ssx\Programm\eTD\bTD\ssx\Type\eTD\bTD\ssx\Space\eTD\bTD\ssx\Notice\eTD\eTR
}}

\unexpanded\def\newday#1{%
\expanded{
\bTR\bTD - \eTD\bTD\ssx#1 \eTD\bTD - \eTD\bTD - \eTD\bTD - \eTD\bTD - \eTD\eTR
}}
	
\def\nadpisdne#1{
\blank[big]
\midaligned{{\bf\ssa #1}}
}


	
\unexpanded\def\lineaction{\tableaction}

\starttext
\midaligned{\ssb Programme of \CONTEXT\ meeting and \TeX perience}

\blank[small]

\midaligned{\ssa Brejlov 13.\,--\,19.~9.~2010}

\blank[big]

\setheader % Imform library, that in first row is header with information about names of columns








\nadpisdne{Monday 13.9.}
\opencsvfile{4CM_programme.csv}
\bTABLE
\doloopif{\Day}{==}{Monday}{\tableaction} % repeat \lineaction macro for all rows of CSV file
\eTABLE


\nadpisdne{Tuesday 14.9.}
\opencsvfile{4CM_programme.csv}
\bTABLE
\doloopif{\Day}{==}{Tuesday}{\tableaction} % repeat \lineaction macro for all rows of CSV file
\eTABLE

\nadpisdne{Wednesday 15.9.}
\opencsvfile{4CM_programme.csv}
\bTABLE
\doloopif{\Day}{==}{Wednesday}{\tableaction} % repeat \lineaction macro for all rows of CSV file
\eTABLE

\page[bigpreference]


\nadpisdne{Thursday 16.9.}
\opencsvfile{4CM_programme.csv}
\bTABLE
\doloopif{\Day}{==}{Thursday}{\tableaction} % repeat \lineaction macro for all rows of CSV file
\eTABLE

\nadpisdne{Friday 17.9.}
\opencsvfile{4CM_programme.csv}
\bTABLE
\doloopif{\Day}{==}{Friday}{\tableaction} % repeat \lineaction macro for all rows of CSV file
\eTABLE

\nadpisdne{Saturday 18.9.}
\opencsvfile{4CM_programme.csv}
\bTABLE
\doloopif{\Day}{==}{Saturday}{\tableaction} % repeat \lineaction macro for all rows of CSV file
\eTABLE

\nadpisdne{Sunday 19.9.}
\opencsvfile{4CM_programme.csv}
\bTABLE
\doloopif{\Day}{==}{Sunday}{\tableaction} % repeat \lineaction macro for all rows of CSV file
\eTABLE


\vfill
\midaligned{\ssx This document was created (generated) using \scancsvlua\ module by Jaroslav Hajtmar.}
\midaligned{\ssx Scancsv.lua presentation to be held on Saturday, 18.~9.~2010 on \ctm+\te\ in Brejlov.} 


\page[no]
\stoptext

